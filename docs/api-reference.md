---
layout: default
title: API Reference
description: Complete REST API documentation for the Financial Data Extractor platform
nav_order: 3
---

# API Reference

The Financial Data Extractor provides a RESTful API built with FastAPI for managing companies, documents, financial statement extractions, and compiled statements.

## Base URL

```
http://localhost:3000/api/v1
```

## API Documentation

The API includes comprehensive interactive documentation automatically generated by FastAPI:

- **Swagger UI**: `http://localhost:3000/docs`
- **ReDoc**: `http://localhost:3000/redoc`
- **OpenAPI Schema**: `http://localhost:3000/openapi.json`

## Common Endpoints

### Health Check

```http
GET /healthcheck
```

Returns the health status of the API.

**Response:**
```json
{
  "status": "Healthy"
}
```

### List All Endpoints

```http
GET /endpoints/
```

Returns a list of all available routes in the application.

**Response:**
```json
{
  "endpoints": [
    {
      "path": "/healthcheck",
      "name": "health_check",
      "methods": ["GET"]
    },
    ...
  ]
}
```

### Metrics

```http
GET /metrics
```

Prometheus metrics endpoint for monitoring and observability.

## API Resources

### Companies

Manage company information and metadata.

#### List All Companies

```http
GET /api/v1/companies
```

**Query Parameters:**
- `skip` (int, default: 0): Number of records to skip
- `limit` (int, default: 100, max: 100): Maximum number of records to return

**Response:** Array of company objects

#### Get Company by ID

```http
GET /api/v1/companies/{company-id}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier

**Response:** Company object

#### Get Company by Ticker

```http
GET /api/v1/companies/ticker/{ticker}
```

**Path Parameters:**
- `ticker` (string): Stock ticker symbol (e.g., "ADYEN")

**Response:** Company object

#### Create Company

```http
POST /api/v1/companies
```

**Request Body:**
```json
{
  "name": "Adyen",
  "ticker": "ADYEN",
  "sector": "Financial Services",
  "country": "Netherlands",
  "investor_relations_url": "https://www.adyen.com/investor-relations",
  "currency": "EUR"
}
```

**Response:** Created company object

#### Update Company

```http
PUT /api/v1/companies/{company-id}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier

**Request Body:** Company update object

**Response:** Updated company object

#### Delete Company

```http
DELETE /api/v1/companies/{company-id}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier

**Response:** 204 No Content

---

### Documents

Manage PDF documents (annual reports, presentations, etc.) associated with companies.

#### List Documents by Company

```http
GET /api/v1/documents/companies/{company-id}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier

**Query Parameters:**
- `skip` (int, default: 0): Number of records to skip
- `limit` (int, default: 100, max: 100): Maximum number of records to return

**Response:** Array of document objects

#### Get Document by ID

```http
GET /api/v1/documents/{document-id}
```

**Path Parameters:**
- `document-id` (int): Unique document identifier

**Response:** Document object

#### Get Documents by Company and Fiscal Year

```http
GET /api/v1/documents/companies/{company-id}/fiscal-year/{fiscal-year}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier
- `fiscal-year` (int, 1900-2100): Fiscal year

**Response:** Array of document objects

#### Get Documents by Company and Type

```http
GET /api/v1/documents/companies/{company-id}/type/{document-type}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier
- `document-type` (string): Document type (e.g., "Annual Report", "Presentation")

**Query Parameters:**
- `skip` (int, default: 0): Number of records to skip
- `limit` (int, default: 100, max: 100): Maximum number of records to return

**Response:** Array of document objects

#### Create Document

```http
POST /api/v1/documents
```

**Request Body:**
```json
{
  "company_id": 1,
  "document_type": "Annual Report",
  "fiscal_year": 2023,
  "filing_date": "2024-03-15",
  "file_path": "/path/to/document.pdf",
  "metadata": {
    "pages": 150,
    "language": "en",
    "source_url": "https://example.com/annual-report-2023.pdf"
  }
}
```

**Response:** Created document object

#### Update Document

```http
PUT /api/v1/documents/{document-id}
```

**Path Parameters:**
- `document-id` (int): Unique document identifier

**Request Body:** Document update object

**Response:** Updated document object

#### Delete Document

```http
DELETE /api/v1/documents/{document-id}
```

**Path Parameters:**
- `document-id` (int): Unique document identifier

**Response:** 204 No Content

---

### Extractions

Manage extracted financial statements from documents.

#### List Extractions by Document

```http
GET /api/v1/extractions/documents/{document-id}
```

**Path Parameters:**
- `document-id` (int): Unique document identifier

**Response:** Array of extraction objects

#### Get Extraction by ID

```http
GET /api/v1/extractions/{extraction-id}
```

**Path Parameters:**
- `extraction-id` (int): Unique extraction identifier

**Response:** Extraction object

#### Get Extraction by Document and Statement Type

```http
GET /api/v1/extractions/documents/{document-id}/statement-type/{statement-type}
```

**Path Parameters:**
- `document-id` (int): Unique document identifier
- `statement-type` (string): Statement type (e.g., "Income Statement", "Balance Sheet", "Cash Flow Statement")

**Response:** Extraction object

#### Create Extraction

```http
POST /api/v1/extractions
```

**Request Body:**
```json
{
  "document_id": 1,
  "statement_type": "Income Statement",
  "extracted_data": {
    "Revenue": 1000000,
    "Operating Expenses": 600000,
    "Net Income": 400000
  },
  "confidence_score": 0.95,
  "metadata": {
    "extraction_method": "LLM",
    "model": "gpt-5",
    "tokens_used": 1500
  }
}
```

**Response:** Created extraction object

#### Update Extraction

```http
PUT /api/v1/extractions/{extraction-id}
```

**Path Parameters:**
- `extraction-id` (int): Unique extraction identifier

**Request Body:** Extraction update object

**Response:** Updated extraction object

#### Delete Extraction

```http
DELETE /api/v1/extractions/{extraction-id}
```

**Path Parameters:**
- `extraction-id` (int): Unique extraction identifier

**Response:** 204 No Content

---

### Compiled Statements

Manage compiled multi-year financial statements.

#### List Compiled Statements by Company

```http
GET /api/v1/compiled-statements/companies/{company-id}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier

**Response:** Array of compiled statement objects

#### Get Compiled Statement by ID

```http
GET /api/v1/compiled-statements/{compiled-statement-id}
```

**Path Parameters:**
- `compiled-statement-id` (int): Unique compiled statement identifier

**Response:** Compiled statement object

#### Get Compiled Statement by Company and Statement Type

```http
GET /api/v1/compiled-statements/companies/{company-id}/statement-type/{statement-type}
```

**Path Parameters:**
- `company-id` (int): Unique company identifier
- `statement-type` (string): Statement type

**Response:** Compiled statement object

#### Create or Update Compiled Statement

```http
POST /api/v1/compiled-statements
```

**Request Body:**
```json
{
  "company_id": 1,
  "statement_type": "Income Statement",
  "compiled_data": {
    "Revenue": {
      "2020": 900000,
      "2021": 950000,
      "2022": 1000000,
      "2023": 1050000
    },
    "Net Income": {
      "2020": 350000,
      "2021": 370000,
      "2022": 400000,
      "2023": 420000
    }
  },
  "data_lineage": {
    "2023": {
      "source_document_id": 5,
      "source_extraction_id": 12
    }
  }
}
```

**Response:** Compiled statement object

#### Update Compiled Statement

```http
PUT /api/v1/compiled-statements/{compiled-statement-id}
```

**Path Parameters:**
- `compiled-statement-id` (int): Unique compiled statement identifier

**Request Body:** Compiled statement update object

**Response:** Updated compiled statement object

#### Delete Compiled Statement

```http
DELETE /api/v1/compiled-statements/{compiled-statement-id}
```

**Path Parameters:**
- `compiled-statement-id` (int): Unique compiled statement identifier

**Response:** 204 No Content

## Common Response Formats

### Success Response

All successful responses follow a standard format:

**GET/PUT Responses:**
```json
{
  "id": 1,
  "name": "Example",
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**POST Responses:**
```json
{
  "id": 1,
  "name": "Created Example",
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**DELETE Responses:**
- 204 No Content (empty body)

### Error Response

Error responses include detailed information:

```json
{
  "detail": "Error description",
  "error_code": "ERROR_CODE",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### Validation Error Response

```json
{
  "detail": [
    {
      "loc": ["body", "name"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

## HTTP Status Codes

- `200 OK`: Request succeeded
- `201 Created`: Resource created successfully
- `204 No Content`: Resource deleted successfully
- `400 Bad Request`: Invalid request data
- `404 Not Found`: Resource not found
- `422 Unprocessable Entity`: Validation error
- `500 Internal Server Error`: Server error

## Authentication

Currently, the API operates without authentication in development. Production deployments should implement OAuth2 with JWT tokens.

## Rate Limiting

No rate limits are currently enforced. Production deployments should implement rate limiting to prevent abuse of expensive operations (especially extraction endpoints).

## Monitoring

The API exposes Prometheus metrics at `/metrics` for monitoring:

- Request latency (p50, p95, p99)
- Request counts by endpoint and method
- Error rates by status code
- Request and response body sizes

## CORS

CORS is configured to allow cross-origin requests from specified origins. In development, this is typically set to `["*"]` for all origins. Production should restrict to specific domains.

## Request Timeout

Default request timeout is 60 seconds. Long-running operations should be handled asynchronously via Celery tasks.

## Examples

### Complete Workflow: Adding a Company and Extracting Financial Data

```bash
# 1. Create a company
curl -X POST http://localhost:3000/api/v1/companies \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Adyen",
    "ticker": "ADYEN",
    "sector": "Financial Services",
    "country": "Netherlands",
    "investor_relations_url": "https://www.adyen.com/investor-relations",
    "currency": "EUR"
  }'

# 2. Get the company ID from response (e.g., company ID is 1)

# 3. Create a document record
curl -X POST http://localhost:3000/api/v1/documents \
  -H "Content-Type: application/json" \
  -d '{
    "company_id": 1,
    "document_type": "Annual Report",
    "fiscal_year": 2023,
    "filing_date": "2024-03-15",
    "file_path": "/data/pdfs/adyen_annual_report_2023.pdf",
    "metadata": {
      "pages": 150,
      "language": "en"
    }
  }'

# 4. Get the document ID from response (e.g., document ID is 1)

# 5. Create an extraction (typically done by Celery worker)
curl -X POST http://localhost:3000/api/v1/extractions \
  -H "Content-Type: application/json" \
  -d '{
    "document_id": 1,
    "statement_type": "Income Statement",
    "extracted_data": {
      "Revenue": 1000000000,
      "Cost of Revenue": 300000000,
      "Gross Profit": 700000000
    },
    "confidence_score": 0.98
  }'

# 6. Get all companies
curl http://localhost:3000/api/v1/companies

# 7. Get all documents for a company
curl http://localhost:3000/api/v1/documents/companies/1

# 8. Get compiled statements for a company
curl http://localhost:3000/api/v1/compiled-statements/companies/1
```

## API Versioning

The API uses URL-based versioning with the `/api/v1` prefix. Future versions will be added as `/api/v2`, etc., maintaining backward compatibility with previous versions.

## Pagination

List endpoints support pagination via `skip` and `limit` query parameters:

- `skip`: Number of records to skip (default: 0)
- `limit`: Maximum number of records to return (default: 100, max: 100)

**Example:**
```http
GET /api/v1/companies?skip=20&limit=50
```

## Filtering and Sorting

Currently, filtering and sorting are not implemented. Future versions will add support for:
- Filtering by metadata fields
- Sorting by creation date, updated date, or other fields
- Full-text search on company names and document types

## Related Documentation

- [Database Schema](database-schema) - Data models and relationships
- [Infrastructure Development](infrastructure-development) - Docker setup and running the API
- [Backend README](../backend/README.md) - Backend development guide
